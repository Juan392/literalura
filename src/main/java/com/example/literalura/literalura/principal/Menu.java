package com.example.literalura.literalura.principal;

import com.example.literalura.literalura.model.*;
import com.example.literalura.literalura.repository.IRepository;
import com.example.literalura.literalura.service.ConsumoApi;
import com.example.literalura.literalura.service.Convertidor;
import org.aspectj.apache.bcel.util.Repository;

import java.util.List;
import java.util.Scanner;

import static com.example.literalura.literalura.service.GeminiAi.resumir;

public class Menu {
    private final String URL_BASE ="https://gutendex.com/books/?";
    private Scanner console = new Scanner(System.in);
    private ConsumoApi consumoApi = new ConsumoApi();
    private Convertidor convertirDatos = new Convertidor();
    private IRepository repository;

    public Menu(IRepository repository) {
        this.repository = repository;
    }

    public void mostrarMenu() {
        System.out.println("""
                ğŸŸ ãŠBienvenido a tu biblioteca personalğŸŸ ãŠ
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢°â¢†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â¢ â ³â¡„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â €â €â¢¸â¢¸â¢³â¡™â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£ â –â¡â €â €â €â¢¸â €â â¡œâ£†â €â €â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â €â €â£ â¢â µâ¢¸â €â €â¢€â¡‡â£¸â €â¡†â ˜â£Œâ¢†â €â£·â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â¢ â¢â¡µâ â¡†â¡‡â €â¡ â ‹â¡¼â €â €â¡‡â €â ˜â ˆâ¢§â¡â¡„â¢ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â¢ â €â €â €â €â¢€â¡´â£¡â¡¯â €â¢€â¡‡â£§â â â¡°â ƒâ €â €â£§â €â €â €â¢¸â¡‡â¢ƒâ¢¸â¢‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â¢¸â¡€â €â €â¢ â¢â¡œâ¡¿â â €â¢¸â£‡â¡µâ â €â €â €â €â €â£¿â €â €â €â ˆâ €â¢¸â£¸â ˜â¡„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â¢¸â¢£â €â¡´â£¡â£¿â â ƒâ €â¢€â£¾â¡¿â â €â €â €â €â €â €â£¿â €â €â €â €â €â ˆâ¡â €â¢‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â¢¸â ˆâ¢‡â¡‡â£¿â¡â €â €â €â£¼â£¿â ƒâ €â €â €â €â¢€â ‡â¡°â£¿â €â €â €â €â €â¡‡â â €â¢¸â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â ¸â â „â €â â¡‡â €â €â£§â£¿â¡‡â¡€â¡œâ¢°â €â €â¡˜â¡â â â¡†â €â €â¡„â¢ â¡‡â¡„â €â ˆâ¡†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â ˆâ ¦â¢ â£§â €â£†â£¿â£¿â¢â£·â£‡â¡‡â €â£´â£¯â €â €â €â¡‡â €â£¸â¡‡â£¾â¡¿â â €â¡€â¡‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â¢€â €â €â €â¢€â¢€â¢ â €â ¸â£¿â£†â¢¹â£¿â£¿â£¾â£¿â£¿â£ â¢¾â ›â â €â €â €â¡‡â¡ â¡Ÿâ£¿â£¿â ƒâ €â €â£¿â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â ˜â¡¶â£„â €â¢¸â ¸â£¼â£§â¡€â£¿â£¿â£¾â£¿â£¿â£¿â£¿â£¿â¡‡â ˜â €â¡€â €â €â¢ â Ÿâ €â ƒâ¢¹â£¥â ƒâ €â¢ â¢â£œâ¡„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â ™â¡Œâ ³â¢„â££â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â¢¿â£¿â¡‡â €â €â¢€â£„â£´â¡¢â €â €â €â¡¿â£¯â €â â â ˜â£»â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â ˜â¢â¢¶â£â£€â ˆâ¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â ‘â£¤â¡€â €â£°â Ÿâ¡¿â â €â €â ˆâ €â â €â €â¡€â¡°â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â ˆâ¢£â£»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â¡€â ˜â£·â£¾â£¿â¡†â €â €â €â €â €â €â €â €â €â¡µâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â ‘â£â »â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£‡â €â£¿â£¿â£¿â£‡â£€â£¤â †â €â â €â ‰â €â ¸â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â ˆâ ‰â¡‡â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¼â£¿â£¿â£¿â£¿â£¿â ‹â €â €â €â €â €â â¢¤â¡€â ™â¢¦â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â ±â¢¬â£™â ›â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£â¡„â €â €â €â €â €â €â ˆâ »â †â €â ˆâ ‘â ’â£¿â£¦â£†â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â €â €â ‰â ‘â ²â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£„â£€â£€â£€â €â €â£€â£€â£ â£´â£¾â£¾â£¿â£¿â£¿â£¿â£¿â£·â£¦â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â €â¢€â£˜â£¿â£·â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¦â ¤â£€â£¤â£€â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â €â¢˜â£¿â Ÿâ£¡â£¶â£¶â£¤â¡„â ™â£¿â£¿â£¿â£¿â£¿â£¿â£Ÿâ¡›â ¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ¿â¢¿â£¿â£¿â£¿â¡¿â Ÿâ£©â£¿â£¿â£¿â£¿â¡€â €â €â¢â €â €â €â €â €â €â €â €â €
                â €â €â €â €â €â €â €â£¶â£¿â¢‹â£¼â¢¿â ¿â¢›â£¿â ·â¢¶â£¶â ‚â ¿â£¿â£¿â£¿â£¿â£¿â£·â£¶â£¤â£€â¡€â ‰â ‰â €â €â£€â£€â¡€â €â €â €â  â¢¾â£¿â£¿â£¿â£¿â£¿â ‡â €â €â£˜â ¢â¡€â €â €â €â €â €â €â €
                â €â €â €â €â €â €â¢€â£½â â ˜â â €â €â â €â  â Ÿâ ›â£¿â£„â¡©â¢‰â£¿â£¿â£¿â£¿â£¿â¡¿â ‹â €â¡ â£¶â£¶â£¶â¡¶â£¶â£¶â£¾â ¿â ¶â €â €â »â£¿â£¿â£¿â£¿â €â €â  â£¿â£·â¡˜â¢†â €â €â €â €â €â €
                â €â €â €â €â €â €â €â¡¸â €â €â €â €â €â €â €â ˆâ €â €â£¿â£¿â£¤â¡ˆâ£¿â£¿â£¿â£¿â¡Ÿâ â£ â£¾â¡‡â €â£¿â£¿â£†â €â €â €â €â£€â£ â£†â €â¢¹â£¿â£¿â¡¿â €â €â¢ â£¿â£¿â£¿â¡˜â¡†â €â €â €â €â €
                â €â €â €â €â €â €â €â¡‡â €â €â €â €â €â €â €â €â €â¢°â£¿â£¿â â£ºâ£¿â£¿â£¿â¡¿â €â¢°â¡Ÿâ ›â ‡â ˜â ¿â£¿â£‡â €â €â£€â €â¢€â£½â£¿â¡€â €â£¿â£¿â ƒâ €â €â¢¸â£¿â£¿â£¿â£§â¢¸â €â €â €â €â €
                â €â €â €â €â €â €â €â¢£â €â €â €â €â €â €â €â¢€â£´â Ÿâ£¿â ƒâ¢°â ¨â£¿â£¿â£¿â ƒâ €â£¿â¡‡â¢€â €â¢°â €â ›â ›â €â €â ›â €â ˆâ ‰â ¹â ‡â €â£¿â¡â €â €â €â£¹â£¿â£¿â£¿â£¿â ˜â¢¦â €â €â €â €
                â €â €â €â €â €â €â €â ˆâ¡†â €â €â €â €â£ â¡¶â ‹â â¡¼â ƒâ €â£¾â ƒâ£¿â£¿â£¿â €â €â¡Ÿâ¢€â¡œâ €â¢‹â£ â£¶â €â €â ’â ’â €â €â£¶â¡¾â €â¢ â â €â €â£ â£¾â£¿â£¿â£¿â£¿â¢¿â â €â££â €â €â €
                â €â €â €â €â €â €â €â£¼â£·â¢¤â£¤â¢¶â Ÿâ â €â €â €â €â¢€â£¼â¡â£¸â£¿â£¿â£¿â£‡â €â¢»â£¿â¡‡â €â£¿â£¿â£¿â €â €â£¶â£¶â €â¢¸â£¿â ƒâ €â â €â €â €â ¿â£¿â£¿â£¿â£¿â¡¿â €â €â¢€â£¯â¢‡â €â €
                â €â €â €â €â €â €â¢°â£¿â£¿â ˜â â â €â €â¢€â£ â£´â£¾â£¿â Ÿâ£°â£¿â£¿â£¿â£¿â£¿â¡„â €â »â €â£ â£¿â£¿â£¿â €â €â ‰â ‰â €â ˜â â¢€â Œâ €â €â €â¢€â €â €â ˆâ ‰â €â €â €â¢€â£¾â£¿â¡¿â €â €
                â €â €â €â €â €â €â¡Ÿâ£¿â¡â €â €â¢€â£ â£¾â£¿â£¿â¡¿â ›â£¡â €â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â£€â ˆâ ™â »â ¿â ¿â ¶â ¾â Ÿâ ƒâ €â¢€â ”â â €â €â €â €â£¾â£†â €â €â €â €â£°â¢€â£¾â£¿â£¿â£§â¡‡â €
                â €â €â €â €â €â¢¸â â£¿â ƒâ¢€â£´â£¿â£¿â£¿â Ÿâ¢»â¢â£¾â£¿â¢€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¦â£¤â£„â£€â¡€â  â ¤â â Šâ €â €â €â €â €â¢€â¡°â£¿â£¿â¡†â €â €â£¿â£§â£¿â£¿â£¿â£¿â£¿â¡‡â €
                â €â €â €â €â €â£Œâ €â ˜â¢ â£¿â£¿â£¿â¡Ÿâ â¢€â£â£¾â£¿â¡‡â£¸â£¿â£¿â£¿â£¿â£¿â£Ÿâ ›â ›â ›â ›â ›â ‰â ‰â €â €â €â €â €â €â €â €â €â €â¡°â ‹â¢±â£¿â£¿â£§â €â¢ â£¿â£¿â£¿â£¿â£¿â£¿â¡â¢±â €
                â €â €â €â €â €â ˆâ ‘â ¢â¢¿â£¿â£¿â¡Ÿâ €â¢€â£¾â£¿â£¿â¡Ÿâ¢ â£¿â£¿â£¿â£¿â¡¿â ¿â¢¿â£¿â£·â£¶â£¤â£¤â£¤â£„â£¤â£¤â£¤â ¤â –â ‚â €â €â£ â Šâ €â €â €â¢¿â£¿â£¿â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â ‡â¢¸â €
                â €â €â €â €â €â €â €â €â €â ‰â ™â £â¢¤â£ˆâ£¿â£¿â â£°â£¿â£¿â£¿â£·â£­â£â£‘â ‚â €â €â ˆâ ‰â ‰â ‰â ‰â ‰â €â €â €â €â €â¢€â¡¼â â €â €â €â €â ˆâ¢¿â¢¿â €â£¼â£¿â£¿â£¿â£¿â£¿â£§â¢´â£¾â¡„
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‰â ‘â šâ ¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ¶â ¶â ¶â –â ’â ‚â €â €â €â €â¢ â â €â €â €â €â €â €â €â ˜â¡„â €â£¿â£¿â£¿â£¿â£¿â£¿â£¡â£¿â£¿â¡‡
                â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ ‰â ‰â ‰â “â ’â ’â ’â ’â ’â ’â ’â ’â Šâ ‰â ‰â ‰â €â €â €â €â €â €â €â €â €â €â ±â ¤â ›â ›â ¿â ¯â ­â ­â ™â ’â šâ 
                """);
        var salida= false;
        while (!salida) {
            System.out.print("""
                    \t\t\t
                    ãŠEste programa te permite:
                    ğŸ‰1 - Agregar un libro.ğŸ‰
                    ğŸ‰2 - Mostrar Libros Agregados.ğŸ‰
                    ğŸ‰3 - Mostrar Autores Agregados.ğŸ‰
                    ğŸ‰4 - Mostrar Autores vivos de determinado tiempo.ğŸ‰
                    ğŸ‰5 - Mostrar Libros Por Idioma.ğŸ‰
                    ğŸ‰6 - Hacer un resumen sobre un libro.ğŸ‰
                    ğŸ‰7 - Salir.ğŸ‰
                    ãŠ
                    
                    ãŠSeleccione una opcion: 
                    """);
            var opcion = console.nextInt();
            System.out.print("ãŠ");
            console.nextLine();
            switch(opcion){
                case 1 -> agregarUnLibro();
                case 2 -> mostrarLibros();
                case 3 -> mostrarAutores();
                case 4 -> mostrarAutoresPorFecha();
                case 5 -> mostrarPorIdioma();
                case 6 -> hacerResumen();
                case 7 -> salida = true;
                default -> System.out.println("ãŠOpcion invalida, vuelva a ingresar su opcion.ãŠ");
            }
        }
    }

    private void hacerResumen() {
        System.out.println("Ingresa el nombre del libro para resumir: ");
        var libro = console.nextLine();
        System.out.println(resumir(libro));
    }

    private void mostrarAutoresPorFecha() {
        System.out.println("ğŸ²â˜¯Ingresa el aÃ±o de inicioğŸ²â˜¯: ");
        var nacimiento = console.nextLong();
        console.nextLine();
        System.out.println("ğŸ²â˜¯Ingresa el aÃ±o de finalizacionğŸ²â˜¯: ");
        var fallecimiento = console.nextLong();
        console.nextLine();
        repository.findByAutorNacimientoGreaterThanEqualAndAutorFallecimientoLessThanEqual(nacimiento,fallecimiento);
    }

    private void mostrarPorIdioma() {
        System.out.println("""
                â›©Nuestros idiomas:
                ğŸ²â˜¯ ğŸ‡ªğŸ‡¸ - EspaÃ±ol ğŸ¥˜
                ğŸ²â˜¯ ğŸ‡¬ğŸ‡§ - InglÃ©s ğŸµ 
                ğŸ²â˜¯ ğŸ‡«ğŸ‡· - FrancÃ©s ğŸ¥ 
                ğŸ²â˜¯ ğŸ‡©ğŸ‡ª - AlemÃ¡n ğŸº 
                ğŸ²â˜¯ ğŸ‡®ğŸ‡¹ - Italiano ğŸ• 
                ğŸ²â˜¯ ğŸ‡µğŸ‡¹ - PortuguÃ©s ğŸ¥– 
                ğŸ²â˜¯ ğŸ‡³ğŸ‡± - NeerlandÃ©s ğŸŒ·
                ğŸ²â˜¯ ğŸ‡·ğŸ‡º - Ruso ğŸª† 
                ğŸ²â˜¯ ğŸ‡¯ğŸ‡µ - JaponÃ©s ğŸ£ 
                ğŸ²â˜¯ ğŸ‡¨ğŸ‡³ - Chino ğŸ‰ 
                
                â›©
                """);
        System.out.println("â›©Ingresa el idioma en el que desea buscarâ›©: ");
        var lenguaje = console.nextLine();
        List<Libro> libros = repository.findByLenguaje(Lenguaje.fromString(lenguaje));
        System.out.println("ğŸ²â˜¯Los libros en ese idioma sonğŸ²â˜¯: ");
        libros.forEach(System.out::println);
    }

    private void mostrarAutores() {
        System.out.println("â›©Ingresa el autorâ›©: ");
        var nombre = console.nextLine();
        List<Libro> libros = repository.findByAutor_AutorIgnoreCase(nombre);
        System.out.println("ğŸ²â˜¯Los libros del autorğŸ²â˜¯: ");
        libros.forEach(System.out::println);
    }

    private void mostrarLibros() {
        System.out.println("â›©Los libros en tu biblioteca sonâ›©: ");
        List<Libro> libros = repository.findAll();
        libros.forEach(System.out::println);
    }

    private void agregarUnLibro() {
        System.out.println("âŸIngresa el nombre del libroâŸ: ");
        var nombre = console.nextLine();
        var json = consumoApi.obtenerDatos(URL_BASE+"search="+nombre.replace(" ", "+"));
        var respuesta = convertirDatos.convertidorDatos(json, DatosRespuesta.class);
        var libro = new Libro(respuesta.resultados().get(0));
        System.out.println(libro);
        repository.save(libro);
    }
}
